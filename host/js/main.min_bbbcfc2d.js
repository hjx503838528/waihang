var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);a.prototype=e.prototype,t.prototype=new a},__awaiter=this&&this.__awaiter||function(t,e,a,i){return new(a||(a=Promise))(function(n,s){function r(t){try{h(i.next(t))}catch(e){s(e)}}function o(t){try{h(i["throw"](t))}catch(e){s(e)}}function h(t){t.done?n(t.value):new a(function(e){e(t.value)}).then(r,o)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function a(t){return function(e){return i([t,e])}}function i(a){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,s&&(r=s[2&a[0]?"return":a[0]?"throw":"next"])&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[0,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return h.label++,{value:a[1],done:!1};case 5:h.label++,s=a[1],a=[0];continue;case 7:a=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){h=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){h.label=a[1];break}if(6===a[0]&&h.label<r[1]){h.label=r[1],r=a;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(a);break}r[2]&&h.ops.pop(),h.trys.pop();continue}a=e.call(t,h)}catch(i){a=[6,i],s=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var n,s,r,o,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},BaseClass=function(){function t(){}return t.ins=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var a=this;if(!a._instance){var i=t.length;0==i?a._instance=new a:1==i?a._instance=new a(t[0]):2==i?a._instance=new a(t[0],t[1]):3==i?a._instance=new a(t[0],t[1],t[2]):4==i?a._instance=new a(t[0],t[1],t[2],t[3]):5==i&&(a._instance=new a(t[0],t[1],t[2],t[3],t[4]))}return a._instance},t}();__reflect(BaseClass.prototype,"BaseClass");var BaseView=function(t){function e(){var e=t.call(this)||this;return e.event=[],e.percentWidth=100,e.percentHeight=100,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addFromStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeFromStage,e),e}return __extends(e,t),e.prototype.addFromStage=function(){this.open()},e.prototype.removeFromStage=function(){this.close()},e.prototype.open=function(){},e.prototype.close=function(){},e.prototype.addTouchEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.addTouchEndEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_END,t,e)},e.prototype.addTouchBeginEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_BEGIN,t,e)},e.prototype.addChangeEvent=function(t,e){this.addEvent(egret.TouchEvent.CHANGE,t,e)},e.prototype.addEvent=function(t,e,a){e.addEventListener(t,a,this),this.event.push([t,a,e])},e.prototype.removeTouchEvent=function(t,e){t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,this)},e.prototype.removeEvents=function(){for(var t=0,e=this.event;t<e.length;t++){var a=e[t];a[2].removeEventListener(a[0],a[1],this)}this.event=[]},e.prototype.$onClose=function(){var t=function(a){for(var i=0;i<a.numChildren;i++){var n=a.getChildAt(i);n instanceof e?n.$onClose():n instanceof egret.DisplayObjectContainer&&t(n)}};t(this),this.removeEvents()},e.prototype.setSkinPart=function(a,i){if(t.prototype.setSkinPart.call(this,a,i),this.skin[a]&&this.skin[a]!=i){var n=this.skin[a].parent,s=n.getChildIndex(this.skin[a]);StageUtils.removeChild(this.skin[a]);for(var r=0;r<e.replaceKeys.length;r++){var o=e.replaceKeys[r];i[o]=this.skin[a][o]}this.skin[a]=i,n.addChildAt(i,s)}},e.replaceKeys=["x","y","alpha","anchorOffsetX","anchorOffsetY","blendMode","bottom","cacheAsBitmap","currentState","enabled","filters","height","horizontalCenter","hostComponentKey","includeInLayout","left","mask","matrix","maxHeight","maxWidth","minHeight","minWidth","name","percentHeight","percentWidth","right","rotation","scaleX","scaleY","scrollRect","skewX","skewY","skinName","top","touchChildren","touchEnabled","verticalCenter","visible","width"],e}(eui.Component);__reflect(BaseView.prototype,"BaseView");var PropItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="PropItemSkin",e}return __extends(e,t),e.prototype.addStage=function(){this.userBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.dataChanged=function(){var t=this.data;this.nameTxt.text=t.name+"x1",this.iconImg.source=t.image},e.prototype.onClick=function(t){Sound.ins().playBtn();var e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.medal:0,i=GameData.userData?GameData.userData.level:0,n=JSON.stringify(this.data);wx.miniProgram.navigateTo({url:GameUrl.CARD+"?data="+n+"&coin="+e+"&medal="+a+"&level="+i})},e.prototype.removeStage=function(){this.userBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e}(eui.ItemRenderer);__reflect(PropItem.prototype,"PropItem");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.createView,e),e}return __extends(e,t),e.prototype.createView=function(){this.stageW=StageUtils.ins().getWidth(),this.stageH=StageUtils.ins().getHeight(),this.width=this.stageW,this.height=this.stageH,this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("loading_bg_jpg"),this.bg.width=this.stageW,this.bg.height=this.stageH,this.addChildAt(this.bg,0);var t=new egret.Shape;t.graphics.beginFill(0,.6),t.graphics.drawRect(0,0,this.stageW,this.stageH),t.graphics.endFill(),this.addChild(t),this.con=new egret.DisplayObjectContainer,this.addChild(this.con),this.barBg=new egret.Bitmap,this.barBg.texture=RES.getRes("bar_bg");var e=new egret.Rectangle(34,30,5,3);this.barBg.scale9Grid=e,this.barBg.width=625,this.con.addChild(this.barBg),this.con.width=this.barBg.width,this.con.height=this.barBg.height,this.con.x=this.stageW/2-this.con.width/2,this.con.y=this.stageH/2-this.con.height/2-30;var a=new egret.Rectangle(12,10,1,1);this.bar=new egret.Bitmap,this.bar.texture=RES.getRes("bar_thumb"),this.bar.x=16,this.bar.y=18,this.bar.width=595,this.bar.scale9Grid=a,this.con.addChild(this.bar),this.mack=new egret.Bitmap,this.mack.texture=RES.getRes("black"),this.mack.x=this.bar.x,this.mack.y=this.bar.y,this.mack.width=0,this.mack.height=this.bar.height,this.con.addChild(this.mack),this.bar.mask=this.mack,this.textField=new egret.TextField,this.textField.width=200,this.textField.height=50,this.textField.size=24,this.textField.textColor=3355443,this.textField.textAlign=egret.HorizontalAlign.CENTER,this.textField.verticalAlign=egret.VerticalAlign.MIDDLE,this.textField.x=this.con.width/2-this.textField.width/2,this.textField.y=this.con.height/2-this.textField.height/2,this.con.addChild(this.textField);var i=new egret.TextField;i.width=200,i.size=34,i.textColor=13163263,i.textAlign=egret.HorizontalAlign.CENTER,i.text="加载中...",i.fontFamily="黑体",i.x=this.stageW/2-i.width/2,i.y=this.con.y+80,this.addChild(i)},e.prototype.onProgress=function(t,e){var a=Math.floor(t/e*100);this.textField.text=a+"%";var i=this.bar.width*(t/e);this.mack.width=i},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var BaseComponent=function(t){function e(){var e=t.call(this)||this;return e.className="使用此组件必须填写逻辑类名",e}return __extends(e,t),e.prototype.childrenCreated=function(){try{var t=window[this.className],a=new t;if(null!=a)for(var i in a)null!=this[i]&&-1==e.copyKeys.indexOf(i)||-1!=e.filterKeys.indexOf(i)||(this[i]=a[i]);this.init&&this.init()}catch(n){egret.log("BaseComponent的className为空："+egret.getQualifiedClassName(this)+"，请查看资源里面的BaseComponent组件是否有未绑定的逻辑类")}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"data"),this.dataChanged&&this.dataChanged()},enumerable:!0,configurable:!0}),e.filterKeys=["data"],e.copyKeys=["open","close"],e}(BaseView);__reflect(BaseComponent.prototype,"BaseComponent");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,a){function i(i){e.call(a,i,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?i(n):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Sound=function(t){function e(){var e=t.call(this)||this;return e.musicBtnR=0,e.musicLoc=0,e}return __extends(e,t),e.prototype.init=function(){var t=this;egret.lifecycle.onPause=function(){e.isOn=e.isPlay,e.ins().upMusic(!1),egret.ticker.pause()},egret.lifecycle.onResume=function(){e.isOn&&(e.ins().upMusic(!0),e.isOn=!1),egret.ticker.resume()},this.musicBtn=new eui.Image("music_off"),this.musicBtn.x=60,this.musicBtn.y=200,this.musicBtn.width=this.musicBtn.height=80,this.musicBtn.anchorOffsetX=this.musicBtn.anchorOffsetY=this.musicBtn.width/2,StageUtils.addChild(this.musicBtn,2),this.musicBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/bgm.mp3",function(e){t.bgmSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/button.mp3",function(e){t.btnSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/game2.mp3",function(e){t.gameSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/gold2.mp3",function(e){t.goldSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/guanqia.mp3",function(e){t.guanqiaSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/medal.mp3",function(e){t.medalSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/message.mp3",function(e){t.messageSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/share.mp3",function(e){t.shareSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/task1.mp3",function(e){t.taskSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/task_win1.mp3",function(e){t.taskWinSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/task_on2.mp3",function(e){t.taskOnSound=e},this),e.URLLoader("https://waixing.oss-cn-beijing.aliyuncs.com/sounds/up.mp3",function(e){t.upSound=e},this)},e.URLLoader=function(t,e,a){var i=new egret.URLLoader;i.addEventListener(egret.Event.COMPLETE,function(t){e.call(a,i.data)},a),i.dataFormat=egret.URLLoaderDataFormat.SOUND,i.load(new egret.URLRequest(t))},e.prototype.onClick=function(t){e.isPlay=!e.isPlay,this.upMusic(e.isPlay)},e.prototype.upMusic=function(t){this.musicBtn&&this.bgmSound&&(e.isPlay=t,this.musicBtn.source=t?"music_on":"music_off",t?this.bgmChannel?(this.bgmChannel=this.bgmSound.play(this.musicLoc,1),this.bgmChannel.addEventListener(egret.Event.SOUND_COMPLETE,this.playBgm,this)):this.bgmChannel=this.bgmSound.play():this.bgmChannel&&(this.musicLoc=this.bgmChannel.position,this.bgmChannel.stop()))},e.prototype.playBgm=function(){this.bgmChannel=this.bgmSound.play(),this.bgmChannel.removeEventListener(egret.Event.SOUND_COMPLETE,this.playBgm,this)},e.prototype.playBtn=function(){this.paly(this.btnSound)},e.prototype.playGame=function(){this.paly(this.gameSound)},e.prototype.playGold=function(){this.paly(this.goldSound)},e.prototype.playGuanqia=function(){this.paly(this.guanqiaSound)},e.prototype.playMedal=function(){this.paly(this.medalSound)},e.prototype.playMessage=function(){this.paly(this.messageSound)},e.prototype.playShare=function(){this.paly(this.shareSound)},e.prototype.playTask=function(){this.paly(this.taskSound)},e.prototype.palyTaskWin=function(){this.paly(this.taskWinSound)},e.prototype.palyTaskOn=function(){this.paly(this.taskOnSound)},e.prototype.palyTaskUp=function(){this.paly(this.upSound)},e.prototype.paly=function(t,e,a){void 0===e&&(e=0),void 0===a&&(a=1);var i=null;return t&&(i=t.play(e,a)),i},e.ins=function(){return t.ins.call(this)},e}(BaseClass);__reflect(Sound.prototype,"Sound");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,a,i){function n(t){e.call(i,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),a.call(i))}var r=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,a){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},r)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var o=t.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(h,function(a){window.JSONParseClass.setData(a),egret.callLater(function(){e.call(i,generateJSON.paths[t])},r)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Websocket=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t="https://www.dingxiangsai.cn/api/v1/message_channel",e=io(t,{query:{token:GameData.token},transports:["websocket"]});e.on("connect",function(){var t=e.id;console.log("#connect,",t,e),e.on(t,function(t){console.log("#receive,",t);var e,a=t.data;"upgrade"==a.action&&(e=a.payload?a.payload.levelTitle:"",Utils.showResult(2,"WOW,你已经升到了\n"+e)),"demotion"==a.action&&(e=a.payload?a.payload.levelTitle:"",Utils.showResult(2,"你已经降级到了\n"+e)),"taskReviewSuccess"==a.action&&(a.payload.props&&a.payload.props.length>0?Utils.showResult(4,"恭喜你获得一个:"+a.payload.props[0].name,a.payload.props[0].image):Utils.showResult(0,a.payload.coin)),"taskReviewFailure"==a.action&&StageUtils.addChild(new ShiBaiWin(a),3)})})},e}(BaseClass);__reflect(Websocket.prototype,"Websocket");var GameData=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getUrlData=function(){var t=window.location.search,a=new Object;if(-1!=t.indexOf("?")){for(var i=t.substr(1),n=i.split("&"),s=0;s<n.length;s++)a[n[s].split("=")[0]]=decodeURIComponent(n[s].split("=")[1]);a.token&&(e.token=a.token),e.id=a.id,e.avatarUrl=a.avatarUrl,e.isSkip=a.skip,e.invitationCode=a.invitationCode,e.taskType=a.taskType,a.latitude&&(e.latitude=a.latitude),a.longitude&&(e.longitude=a.longitude),BranchData.curId=a.branchId,egret.log(a)}},e.prototype.getUserData=function(){var t=this;return new Promise(function(a,i){Http.ins().send(GameUrl.userUrl,!1,t,function(t){var i=t.result;if(e.userData=t.result,console.log(i),e.userData&&("o2O1G48pd9-3kXHK1wIcX3HxfkW4"==e.userData.openId||"A丶Top。"==e.userData.nickName))try{eruda&&eruda.init&&(eruda.init(),console.info("打开手机调试啊"),console.log(e.token),console.log(e.userData))}catch(t){}a()},function(t){i(t);var e=new egret.TextField;e.text="人物信息数据出错,请授权。",e.size=50,e.x=50,e.y=150,e.textColor=16711680,StageUtils.addChild(e)})})},e.prototype.getData=function(){var t=this;return new Promise(function(a,i){var n=GameUrl.ltaskUrl+"?latitude="+e.latitude+"&longitude="+e.longitude;console.log("经纬度",e.longitude,e.latitude),Http.ins().send(n,!0,t,function(t){var i=t.result;if(console.log(i),e.taskData=i,e.rankLineIdArr[0]=e.taskData[0].lineId,e.taskData)for(var n=e.taskData.length,s=0;n>s;s++)e.taskData[s].index=s+1;a(e.taskData)},function(t){i(t);var e=new egret.TextField;e.text="任务数据出错,请授权。 ",e.size=50,e.x=50,e.y=150,e.textColor=16711680,StageUtils.addChild(e)})})},e.prototype.senfSigninData=function(){var t=this;return new Promise(function(a,i){Http.ins().send(GameUrl.signinUrl,!0,t,function(t){var i=t.result;e.signinData=i,console.log("签到数据"),console.log(e.signinData);for(var n=(new Date).getDate(),s=e.signinData.length,r=0;s>r;r++)if(null==e.signinData[r].signedAt){var o=e.signinData[r].date;o=o.replace(/-/g,"/");var h=new Date(o).getDate();if(n==h){StageUtils.addChild(new SignInWin);break}}a()},function(t){i(t)})})},e.prototype.getSigninDay=function(){var t=0;if(e.signinData)for(var a=e.signinData.length,i=0;a>i;i++)null!=e.signinData[i].signedAt&&t++;return t},e.prototype.getDaySignin=function(t){var a=!1;if(e.signinData&&null==e.signinData[t].signedAt){var i=(new Date).getDate(),n=e.signinData[t].date;n=n.replace(/-/g,"/");var s=new Date(n).getDate();i==s&&(a=!0)}return a},e.prototype.getCurIndex=function(){for(var t=0,a=e.taskData?e.taskData.length:0,i=0;a>i;i++){var n=e.taskData[i].userTask?e.taskData[i].userTask.state:0;if(n==GameState.NO||n==GameState.YES||n==GameState.DEFEATED){t=i+1;break}}return t},e.ins=function(){return t.ins.call(this)},e.token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTAsIm9wZW5JZCI6Im9DaDJINU90X3Y0MGlxcjJYVHI0WWhpc1JIVGciLCJyb2xlIjowLCJpYXQiOjE1NTEyNzg3MTV9.su3WS6TqdliWpkd6LY4wByjeOgtkSf0y65T5e3zChjk",e.nickName="",e.rankLineIdArr=[],e.rankIndex=0,e.latitude=30.66737937927246,e.longitude=104.0518798828125,e}(BaseClass);__reflect(GameData.prototype,"GameData");var GameUrl=function(){function t(){}return t.redirectTo=function(e,a){switch(e){case Type.SELECT:wx.miniProgram.redirectTo({url:t.SELECTURL+a});break;case Type.PICTURE:wx.miniProgram.redirectTo({url:t.PICTUREURL+a});break;case Type.VIDEO:wx.miniProgram.redirectTo({url:t.VIDEOURL+a});break;case Type.QR_CODE:wx.miniProgram.redirectTo({url:t.CODEURL+a});break;case Type.AUDIO:wx.miniProgram.redirectTo({url:t.AUDIOURL+a});break;case Type.TASKSTORY:wx.miniProgram.redirectTo({url:t.TASKSTORY+a})}},t.url="https://www.dingxiangsai.cn",t.userUrl=t.url+"/api/v1/users/get_info_by_token",t.ltaskUrl=t.url+"/api/weapp/v1/tasks/by_coordinate",t.taskUrl=t.url+"/api/v1/tasks",t.inviteUrl=t.url+"/api/v1/tasks/get_task_by_invitation_code/",t.rankUrl=t.url+"/api/v1/lines/",t.signinUrl=t.url+"/api/v1/users/signs",t.sendSigninUrl=t.url+"/api/v1/users/sign",t.linetask=t.url+"/api/weapp/v1/lines/",t.by_coordinate=t.url+"/api/weapp/v1/tasks/by_coordinate",t.props=t.url+"/api/v1/props",t.SELECTURL="/pages/TaskSelect/TaskSelect",t.PICTUREURL="/pages/TaskPicture/TaskPicture",t.VIDEOURL="/pages/TaskVideo/TaskVideo",t.AUDIOURL="/pages/TaskAudio/TaskAudio",t.CODEURL="/pages/TaskQrcode/TaskQrcode",t.TASKSTORY="/pages/TaskStory/TaskStory",t.SHAREURL="/pages/InviteShare/InviteShare",t.SIGNSHARE="/pages/SignShare/SignShare",t.CARD="/pages/Card/Card",t}();__reflect(GameUrl.prototype,"GameUrl");var Http=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.send=function(t,e,a,i,n,s){var r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(t,e?egret.HttpMethod.GET:egret.HttpMethod.POST);var o="Bearer "+GameData.token;r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Authorization",o),r.once(egret.Event.COMPLETE,function(t){var e=t.currentTarget,n=JSON.parse(e.response);i.call(a,n)},a),r.once(egret.IOErrorEvent.IO_ERROR,n?n:function(){},a),r.once(egret.ProgressEvent.PROGRESS,s?s:function(){},a),r.send()},e.prototype.sendGetTaskData=function(t,e,a,i,n,s){var r={latitude:23,longitude:116},o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.open(t,e?egret.HttpMethod.GET:egret.HttpMethod.POST);var h="Bearer "+GameData.token;o.setRequestHeader("Authorization",h),o.once(egret.Event.COMPLETE,function(t){var e=t.currentTarget,n=JSON.parse(e.response);i.call(a,n)},a),o.once(egret.IOErrorEvent.IO_ERROR,n?n:function(){},a),o.once(egret.ProgressEvent.PROGRESS,s?s:function(){},a),o.send(JSON.stringify(r))},e.prototype.sendGet=function(t,e,a,i,n){var s=new egret.HttpRequest;s.responseType=egret.HttpResponseType.TEXT,s.open(t,egret.HttpMethod.GET);var r="Bearer "+GameData.token;s.setRequestHeader("Authorization",r),s.once(egret.Event.COMPLETE,function(t){var i=t.currentTarget,n=JSON.parse(i.response);a.call(e,n)},e),s.once(egret.IOErrorEvent.IO_ERROR,i?i:function(){console.error("出错地址:"+t)},e),s.once(egret.ProgressEvent.PROGRESS,n?n:function(){},e),s.send()},e.prototype.sendPost=function(t,e,a,i,n){var s=new egret.HttpRequest;s.responseType=egret.HttpResponseType.TEXT,s.open(t,egret.HttpMethod.POST);var r="Bearer "+GameData.token;s.setRequestHeader("Authorization",r),s.once(egret.Event.COMPLETE,function(t){var i=t.currentTarget,n=JSON.parse(i.response);a.call(e,n)},e),s.once(egret.IOErrorEvent.IO_ERROR,i?i:function(){},e),s.once(egret.ProgressEvent.PROGRESS,n?n:function(){},e),s.send()},e.prototype.sendMagCallBack=function(t,e,a,i,n){var s=new egret.URLLoader;s.dataFormat=egret.URLLoaderDataFormat.TEXT;var r=new egret.URLRequest(t);r.method=i,r.data=e,s.addEventListener(egret.Event.COMPLETE,function(t){var e=t.target,i=e.data,s=JSON.parse(i.toString());a.call(n,s)},this),s.load(r)},e.prototype.GetRequest=function(t,e,a){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(t,egret.HttpMethod.GET),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(),i.once(egret.Event.COMPLETE,function(t){var i=t.currentTarget,n=JSON.parse(i.response);e.call(a,n)},this)},e}(BaseClass);__reflect(Http.prototype,"Http");var ImageLoader=function(){function t(){}return t.Image=function(t){var e=this;return new Promise(function(a,i){var n=new egret.ImageLoader;n.once(egret.Event.COMPLETE,function(t){var e=t.currentTarget,i=e.data,n=new egret.Texture;n.bitmapData=i,a(n)},e),n.once(egret.IOErrorEvent.IO_ERROR,function(t){i(t)},e),t?n.load(t):i("图片地址不存在")})},t.createImg=function(t){return new Promise(function(e,a){var i=new Image;i.onload=function(){i.onload=null;var t=new egret.BitmapData(i),a=new egret.Texture;a.bitmapData=t;var n=new egret.Bitmap;n.texture=a,e(n)},i.src=t})},t.createImg2=function(t){return new Promise(function(e,a){var i=t.replace("data:image/png;base64,","");egret.BitmapData.create("base64",i,function(t){var a=new egret.Texture;a.bitmapData=t;var i=new egret.Bitmap(a);e(i)})})},t.imaBase64=function(t,e,a){void 0===e&&(e=!0),void 0===a&&(a=1);var i=new egret.RenderTexture,n=new egret.Rectangle(0,0,t.width,t.height);i.drawToTexture(t,n);var s=i.toDataURL(e?"image/png":"image/jpeg",n,a);return s},t}();__reflect(ImageLoader.prototype,"ImageLoader");var ObjectPool=function(){function t(){this._objs=new Array}return t.prototype.pushObj=function(t){this._objs.push(t)},t.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},t.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e){for(var a=[],i=1;i<arguments.length;i++)a[i-1]=arguments[i];t._content[e]||(t._content[e]=[]);var n=t._content[e];if(n.length){var s=n.pop();return s}var r=window[e],o=a.length,h=void 0;return 0==o?h=new r:1==o?h=new r(a[0]):2==o?h=new r(a[0],a[1]):3==o?h=new r(a[0],a[1],a[2]):4==o?h=new r(a[0],a[1],a[2],a[3]):5==o&&(h=new r(a[0],a[1],a[2],a[3],a[4])),h.ObjectPoolKey=e,h},t.popWithExtraKey=function(e,a){t._content[e]||(t._content[e]=[]);var i,n=t._content[e];if(n.length)for(var s=0;s<n.length;s++)if(n[s].extraKey==a){i=n[s],n.splice(s,1);break}if(!i){var r=window[e];i=new r(a),i.extraKey=a,i.ObjectPoolKey=e}return i},t.push=function(e){if(null==e)return!1;var a=e.ObjectPoolKey;return!t._content[a]||t._content[a].indexOf(e)>-1?!1:(t._content[a].push(e),!0)},t.clear=function(){t._content={}},t.clearClass=function(e,a){void 0===a&&(a=null);for(var i=t._content[e];i&&i.length;){var n=i.pop();a&&n[a](),n=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,a){var i=t._content[e];if(null!=i){var n=0,s=i.length;for(n;s>n;n++)i[n][a]()}},t._content={},t}();__reflect(ObjectPool.prototype,"ObjectPool");var ScreenMovies=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.MovieStart=function(t){function e(t){y++,y==r&&a.removeChild(s)}var a=StageUtils.ins().getStage(),i=StageUtils.ins().getWidth(),n=StageUtils.ins().getHeight(),s=new eui.Group;s.width=i,s.height=n,a.addChild(s);for(var r=40,o=5,h=r/o,c=0;r>c;c++){var l=i/o,u=n/h,d=c%o*l,p=Math.floor(c/o)*u,g=new egret.RenderTexture,m=(g.drawToTexture(a,new egret.Rectangle(d,p,l,u)),new egret.Bitmap);switch(m.texture=g,m.anchorOffsetX=l/2,m.anchorOffsetY=u/2,m.x=d+l/2,m.y=p+u/2,s.addChild(m),5==t&&(t=Math.ceil(4*Math.random())),t){case 1:var v=egret.Tween.get(m);v.to({scaleX:0,scaleY:0,alpha:0,rotation:359},800,egret.Ease.circIn).call(e,this);break;case 2:var f=-i;c%2||(f=2*i);var v=egret.Tween.get(m);v.to({x:f,alpha:0},800,egret.Ease.circIn).call(e,this);break;case 3:var v=egret.Tween.get(m);v.to({scaleX:.2,scaleY:1,alpha:0,blurFliter:0},800,egret.Ease.backInOut).call(e,this);break;case 4:var v=egret.Tween.get(m);v.to({alpha:0},900,egret.Ease.circIn).call(e,this);break;default:var v=egret.Tween.get(m);v.to({scaleX:1,scaleY:0,alpha:0},800,egret.Ease.circIn).call(e,this)}}var y=0},e}(BaseClass);__reflect(ScreenMovies.prototype,"ScreenMovies");var StageUtils=function(t){function e(){var e=t.call(this)||this;return e.top=80,e}return __extends(e,t),e.prototype.init=function(){e._uiStage=new eui.UILayer,e._uiStage.touchEnabled=!1,e._uiStage.percentHeight=100,e._uiStage.percentWidth=100,this.getStage().addChild(e._uiStage),e.Game_Bg=new eui.UILayer,e.Game_Bg.touchEnabled=!1,e.Game_Bg.percentHeight=100,e.Game_Bg.percentWidth=100,e._uiStage.addChild(e.Game_Bg),e.Game_Main=new eui.UILayer,e.Game_Main.touchEnabled=!1,e.Game_Main.percentHeight=100,e.Game_Main.percentWidth=100,e._uiStage.addChild(e.Game_Main),e.UI_Main=new eui.UILayer,e.UI_Main.touchEnabled=!1,e.UI_Main.percentHeight=100,e.UI_Main.percentWidth=100,e._uiStage.addChild(e.UI_Main),e.UI_Tips=new eui.UILayer,e.UI_Tips.touchEnabled=!1,e.UI_Tips.percentHeight=100,e.UI_Tips.percentWidth=100,e._uiStage.addChild(e.UI_Tips)},e.ins=function(){return t.ins.call(this)},e.prototype.getHeight=function(){return this.getStage().stageHeight},e.prototype.getWidth=function(){return this.getStage().stageWidth},e.prototype.setTouchChildren=function(t){this.getStage().touchChildren=t},e.prototype.setMaxTouches=function(t){this.getStage().maxTouches=t},e.prototype.setFrameRate=function(t){this.getStage().frameRate=t},e.prototype.setScaleMode=function(t){this.getStage().scaleMode=t},e.prototype.getStage=function(){return egret.MainContext.instance.stage},e.prototype.getUIStage=function(){return e._uiStage},e.addChild=function(t,a){if(void 0===a&&(a=2),null!=t)switch(a){case 0:e.Game_Bg.removeChildren(),e.Game_Bg.addChild(t);break;case 1:e.Game_Main.addChild(t);break;case 2:e.UI_Main.addChild(t);break;case 3:e.UI_Tips.addChild(t)}},e.removeChild=function(t){t&&null!=t.parent&&t.parent.removeChild(t)},e.w=750,e.h=1334,e.Game_Bg=new eui.UILayer,e.Game_Main=new eui.UILayer,e.UI_Main=new eui.UILayer,e.UI_Tips=new eui.UILayer,e}(BaseClass);__reflect(StageUtils.prototype,"StageUtils");var TipsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TipsSkin",e.touchChildren=!1,e.touchEnabled=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"labelText",{get:function(){return this._labelText},set:function(t){var e=this;if(this.lab){this._labelText=t,this.lab.text=this._labelText,this.bg.alpha=.7,this.lab.alpha=1,this.bg.y=0,this.lab.verticalCenter=-1;var a=egret.Tween.get(this);a.to({y:this.y-30},500).wait(500).to({alpha:0},200).call(function(){StageUtils.removeChild(e)},this)}},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(TipsItem.prototype,"TipsItem"),window.TipsItem=TipsItem;var Type;!function(t){t[t.SELECT=1]="SELECT",t[t.PICTURE=2]="PICTURE",t[t.VIDEO=3]="VIDEO",t[t.QR_CODE=4]="QR_CODE",t[t.AUDIO=5]="AUDIO",t[t.TASKSTORY=6]="TASKSTORY"}(Type||(Type={}));var GameState;!function(t){t[t.NO=0]="NO",t[t.YES=10]="YES",t[t.SUB=20]="SUB",t[t.CHECKING=30]="CHECKING",t[t.SUCCEED=40]="SUCCEED",t[t.DEFEATED=50]="DEFEATED"}(GameState||(GameState={}));var TaskType;!function(t){t[t.ZHU=0]="ZHU",t[t.BRANCH=1]="BRANCH"}(TaskType||(TaskType={}));var Utils=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.isNewData=function(){var t,e=new Date,a=e.getDate(),i=(e.getMonth()+1,e.getFullYear(),"data"),n=egret.localStorage.getItem(i);if(null==n||n!=a.toString()){var s=a.toString();egret.localStorage.setItem(i,s),t=!0}else t=!1;return t},e.prototype.playAnimation=function(t,e){if(e)for(var a in t.items)t.items[a].props={loop:!0};t.play()},e.getStringLength=function(t){for(var a=t.split(""),i=0,n=0;n<a.length;n++){var s=a[n];i+=e.isChinese(s)?2:1}return i},e.isChinese=function(t){var e=/^[\u4E00-\u9FA5]+$/;return e.test(t)?!0:!1},e.getStting=function(t){var e="?";for(var a in t){var i=a+"="+t[a]+"&";e+=i}return e=e.substring(0,e.length-1)},e.showResult=function(t,e,a){void 0===a&&(a="");var i={index:t,lable:e,icon:a},n=new ResultWin;StageUtils.addChild(n,3),n.setData(i)},e.prototype.setTips=function(t){var e=ObjectPool.pop("TipsItem");e.horizontalCenter=0,e.y=300,StageUtils.ins().getUIStage().addChild(e),e.labelText=t},e.prototype.convertUTCTimeToLocalTime=function(t){function e(t){return t>9?t:"0"+t}if(!t)return"";var a=new Date(t),i=a.getFullYear(),n=e(a.getMonth()+1),s=e(a.getDate()),r=a.getHours();r=e(r);var o=e(a.getMinutes()),h=i+"-"+n+"-"+s+" "+r+":"+o;return h},Object.defineProperty(e.prototype,"colorMat",{get:function(){return new egret.ColorMatrixFilter([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),e}(BaseClass);__reflect(Utils.prototype,"Utils");var Wx=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.navigateTo=function(t){wx.miniProgram.navigateTo({url:t})},e.prototype.navigateBack=function(t){wx.miniProgram.navigateBack({delta:t})},e.prototype.redirectTo=function(t){wx.miniProgram.redirectTo({url:t})},e.prototype.reLaunch=function(t){wx.miniProgram.reLaunch({url:t})},e.prototype.switchTab=function(t){wx.miniProgram.switchTab({url:t})},e.prototype.config=function(){var t;wx.config({debug:!1,appId:t[0],timestamp:t[1],nonceStr:t[2],signature:t[3],jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","updateAppMessageShareData"]}),wx.ready(function(){var t={title:"外行城市",desc:"外行城市",imgUrl:"resource/assets/bg3.png",link:"",success:function(){console.log("分享成功")},fail:function(){console.log("分享失败")},complete:function(){console.log("分享接口调用结束")}};wx.onMenuShareAppMessage(t)}),wx.error(function(t){alert("好像出错了！！")})},e}(BaseClass);__reflect(Wx.prototype,"Wx");var AwardList=function(t){function e(){var e=t.call(this)||this;return e.skinName="AwardListSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"data"),this.dataChanged()},enumerable:!0,configurable:!0}),e}(eui.ItemRenderer);__reflect(AwardList.prototype,"AwardList");var GameWin=function(t){function e(){var a=t.call(this)||this;return a.skinName="GameSkin",e.self=a,a}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.jiaBtn,this.onClick),this.addTouchEvent(this.xiaoxiBtn,this.onClick),this.addTouchEvent(this.bagBtn,this.onClick),this.addTouchEvent(this.rankBtn,this.onClick),this.addTouchEvent(this.helpBtn,this.onClick),this.addTouchEvent(this.friendBtn,this.onClick),this.addTouchEvent(this.dailyTaskBtn,this.onClick),this.txImg.mask=this.rectMack,this.map=new Map,this.mapCon.addChild(this.map),this.tween(),this.initData()
},e.prototype.tween=function(){var t=egret.Tween.get(this.yun0,{loop:!0}),e=egret.Tween.get(this.yun1,{loop:!0}),a=egret.Tween.get(this.yun2,{loop:!0}),i=egret.Tween.get(this.yun3,{loop:!0}),n=egret.Tween.get(this.yun4,{loop:!0});t.to({x:110},1e4).to({x:75},1e4),e.to({x:445},1e4).to({x:280},12e3).to({x:336},1e4),a.to({x:-300},15e3).to({x:-162},14e3),i.to({x:800},2e4).to({x:242},2e4),n.to({x:-600},18e3).to({x:-125},21e3)},e.prototype.initData=function(){GameData.userData&&(this.txImg.source=GameData.userData.avatarUrl,this.lvTxt.text="Lv."+GameData.userData.level,this.goldTxt.text=GameData.userData.coin+"",this.mdalTxt.text=GameData.userData.medal+"")},e.prototype.onClick=function(t){switch(t.target){case this.xiaoxiBtn:var e="亲爱的时间调查员：模拟试炼即将结束，系统需要重启。重启后时间调查员的任务将重新开启，历史数据将被清空，时间调查员们，新的试炼即将到来，一起拯救地球吧。";StageUtils.addChild(new MessageWin("消息",e)),Sound.ins().playMessage();break;case this.bagBtn:break;case this.rankBtn:StageUtils.addChild(new RankWin),Sound.ins().playBtn();break;case this.helpBtn:Sound.ins().playMessage();var a=GameData.userData?GameData.userData.nickName:"",i="亲爱的时间调查员"+a+"：鉴于你刚刚来到地球，时间调查委员会为你安排了一位地球顾问，如果需要帮助可以联系他，他的微信是"+a+"，但是要尽量少联系，避免暴露你们的身份。";StageUtils.addChild(new MessageWin("帮助",i));break;case this.friendBtn:Sound.ins().playBtn(),StageUtils.addChild(new CommanView(0));break;case this.dailyTaskBtn:Sound.ins().playBtn(),StageUtils.addChild(new DailyTaskView)}},e.prototype.close=function(){this.removeEvents(),this.yun.stop()},e}(BaseView);__reflect(GameWin.prototype,"GameWin");var HomeScene=function(t){function e(){var e=t.call(this)||this;return e.skinName="HomeSkin",e}return __extends(e,t),e.prototype.open=function(){this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),Utils.ins().playAnimation(this.yun,!0)},e.prototype.onClick=function(t){switch(t.target){case this.startBtn:}},e.prototype.removeStage=function(){this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.yun.stop()},e}(BaseView);__reflect(HomeScene.prototype,"HomeScene");var BagView=function(t){function e(){var e=t.call(this)||this;return e.skinName="BagViewSkin",e}return __extends(e,t),e.prototype.open=function(){this.init(),this.addTouchEvent(this.backHome,this.onClick),this.addTouchEvent(this.medalBtn,this.onClick),this.addTouchEvent(this.cardBtn,this.onClick),this.addTouchEvent(this.daojuBtn,this.onClick)},e.prototype.init=function(){GameData.userData&&(this.lvTxt.text="Lv."+GameData.userData.level,this.goldTxt.text=GameData.userData.coin+"",this.mdalTxt.text=GameData.userData.medal+"")},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.backHome:StageUtils.removeChild(this);break;case this.medalBtn:StageUtils.addChild(new PropView(3));break;case this.cardBtn:StageUtils.addChild(new PropView(1));break;case this.daojuBtn:StageUtils.addChild(new PropView(2))}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(BagView.prototype,"BagView");var CardItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CardItemSkin",e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeStage,e),e}return __extends(e,t),e.prototype.addStage=function(){this.useBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.dataChanged=function(){var t=this.data;this.explainTxt.text=t.name+"x1",this.iconImg.source=t.image;var e=Utils.ins().convertUTCTimeToLocalTime(t.expiredAt);this.timeTxt.text="有效期："+e},e.prototype.onClick=function(t){Sound.ins().playBtn();var e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.medal:0,i=GameData.userData?GameData.userData.level:0,n=JSON.stringify(this.data);wx.miniProgram.navigateTo({url:GameUrl.CARD+"?data="+n+"&coin="+e+"&medal="+a+"&level="+i})},e.prototype.removeStage=function(){this.useBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e}(eui.ItemRenderer);__reflect(CardItem.prototype,"CardItem");var MedalItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="MedalItemSkin",e.filters=[Utils.ins().colorMat],e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;t>0?this.iconImg.source="medal"+t:this.iconImg.source="medal_no"},e}(eui.ItemRenderer);__reflect(MedalItem.prototype,"MedalItem");var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.ImageLoader.crossOrigin="anonymous",egret.lifecycle.addLifecycleListener(function(t){});var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),GameData.ins().getUrlData(),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,a;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json?="+e.VERSION,"resource/")];case 1:return i.sent(),t=new LoadingUI,[4,RES.loadGroup("loading")];case 2:return i.sent(),this.stage.addChild(t),[4,this.loadTheme()];case 3:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 4:return i.sent(),this.stage.removeChild(t),[3,6];case 5:return a=i.sent(),console.error(a),[3,6];case 6:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(a,i){var n=new eui.Theme("resource/default.thm.json?="+e.VERSION,t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){a()},t)})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return StageUtils.ins().init(),Sound.ins().init(),console.log("窗口宽高",StageUtils.ins().getWidth(),StageUtils.ins().getHeight()),this.uIView=new UIView,StageUtils.addChild(this.uIView,1),GameData.ins().getUserData().then(function(){t.uIView&&t.uIView.initData()}),Websocket.ins().init(),[4,GameData.ins().getData()];case 1:return e.sent(),1==GameData.taskType?StageUtils.addChild(new BranchWin,0):StageUtils.addChild(new GameView,0),[4,GameData.ins().senfSigninData()];case 2:return e.sent(),GameData.invitationCode&&StageUtils.addChild(new CommanView(0,GameData.invitationCode)),[2]}})})},e.VERSION="1.0.2",e}(eui.UILayer);__reflect(Main.prototype,"Main");var PropView=function(t){function e(e){var a=t.call(this)||this;return a.skinName="PropViewSkin",a.type=e,a}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.backHome,this.onClick),this.medalList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onCliskMedal,this),this.medalList.itemRenderer=MedalItem,this.cardList.itemRenderer=CardItem,this.propList.itemRenderer=PropItem,this.medalScroller.height=this.cardScroller.height=this.propScroller.height=Math.floor(.73*StageUtils.ins().getHeight()),this.initData(),this.setView(),this.medalList.dataProvider=new eui.ArrayCollection([1,2,3,4,5,6,7,8,9,-1])},e.prototype.initData=function(){GameData.userData&&(this.lvTxt.text="Lv."+GameData.userData.level,this.goldTxt.text=GameData.userData.coin+"",this.mdalTxt.text=GameData.userData.medal+"")},e.prototype.setView=function(){var t=this,e=["","卡 券","道 具","勋 章"];this.backHome.source="icon_baek"+this.type,this.titleBg.source="btn_bg"+this.type,this.titleTxt.text=e[this.type],this.medalCon.visible=!1,this.cardCon.visible=!1,this.propCon.visible=!1,1==this.type?(this.cardCon.visible=!0,Http.ins().send(GameUrl.props+"?propType=1",!0,this,function(e){var a=e.result;a.length>0&&(t.cardList.dataProvider=new eui.ArrayCollection(a))})):2==this.type?(this.propCon.visible=!0,Http.ins().send(GameUrl.props+"?propType=0",!0,this,function(e){var a=e.result;a.length>0&&(t.propList.dataProvider=new eui.ArrayCollection(a))})):3==this.type&&(this.medalCon.visible=!0)},e.prototype.onCliskMedal=function(t){Utils.ins().setTips("尚未获得")},e.prototype.onCliskCard=function(t){},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.backHome:StageUtils.removeChild(this)}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(PropView.prototype,"PropView");var BranchData=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getCurIndex=function(){for(var t=0,a=e.taskData?e.taskData.length:0,i=0;a>i;i++){var n=e.taskData[i].userTask?e.taskData[i].userTask.state:0;if(n==GameState.NO||n==GameState.YES||n==GameState.DEFEATED){t=i+1;break}}return t},e.ins=function(){return t.ins.call(this)},e}(BaseClass);__reflect(BranchData.prototype,"BranchData");var BranchWin=function(t){function e(){var a=t.call(this)||this;return a.skinName="BranchSkin",e.self=a,a}return __extends(e,t),e.prototype.open=function(){UIView.self.backHome.visible=!0,BranchData.curId&&Http.ins().send(GameUrl.linetask+BranchData.curId+"/tasks",!0,this,this.initData)},e.prototype.initData=function(t){var e=t.result;if(BranchData.taskData=e,BranchData.taskData[0]?GameData.rankLineIdArr[1]=BranchData.taskData[0].lineId:GameData.rankLineIdArr[1]=GameData.taskData[0].lineId,console.log(e),BranchData.taskData)for(var a=BranchData.taskData.length,i=0;a>i;i++)BranchData.taskData[i].index=i+1;this.map=new Map(TaskType.BRANCH),this.mapCon.addChild(this.map)},e.prototype.onClick=function(t){t.target},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(BranchWin.prototype,"BranchWin");var ZxTaskView1=function(t){function e(e){var a=t.call(this)||this;return a.skinName="ZxTaskViewSkin1",a.data=e,a}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.zxstartBtn,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),this.addTouchEvent(this.shareBtn,this.onClick),this.addTouchEvent(this.refreshBtn,this.onClick),this.titleTxt.text=this.data.branch.name,this.nameTxt.text=this.data.branch.desc,this.hintTxt.text=""},e.prototype.initData=function(t){var e=t.result;if(BranchData.taskData=e,console.log(e),BranchData.taskData)for(var a=BranchData.taskData.length,i=0;a>i;i++)BranchData.taskData[i].index=i+1},e.prototype.onClick=function(t){switch(t.target){case this.zxstartBtn:Sound.ins().playTask(),StageUtils.removeChild(this),BranchData.curId=this.data.branch.id,StageUtils.addChild(new BranchWin,0);break;case this.closeBtn:case this.shade:Sound.ins().playBtn(),StageUtils.removeChild(this);break;case this.shareBtn:var e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.medal:0,i=GameData.userData?GameData.userData.exp:0,n={task:this.data.branch.id,coin:e,medal:a,exp:i,typeId:this.data.index,title:this.data.branch.name},s=Utils.getStting(n);wx.miniProgram.navigateTo({url:GameUrl.SHAREURL+s}),Sound.ins().playShare();break;case this.refreshBtn:this.setToData(),Sound.ins().playTask(),StageUtils.removeChild(this)}},e.prototype.setToData=function(){var t=this.data.userTask?this.data.userTask.state:0,e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.medal:0,i=GameData.userData?GameData.userData.level:0,n={taskId:this.data.id,coin:e,level:i,medal:a,index:this.data.index,state:t},s=Utils.getStting(n);GameUrl.redirectTo(this.data.type,s)},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(ZxTaskView1.prototype,"ZxTaskView1");var ZxTaskView2=function(t){function e(e){var a=t.call(this)||this;return a.skinName="ZxTaskViewSkin2",a.data=e,a}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.startBtn,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),this.addTouchEvent(this.shareBtn,this.onClick),this.addTouchEvent(this.refreshBtn,this.onClick),this.initData()},e.prototype.initData=function(){this.titleTxt.text=this.data.name,this.numTxt.text="有"+this.data.completeNumber+"位调查员\n已完成了该任务";var t=this.data.coin?this.data.coin:0,e=this.data.exp?this.data.exp:0,a=this.data.medalId?this.data.medalId.split(","):[],i=[{source:"gold2",text:"+"+t},{source:"icon_xp1",text:"+"+e},{source:"icon_xz2",text:"+"+a.length}];this.list.dataProvider=new eui.ArrayCollection(i);var n=this.data.userTask?this.data.userTask.state:0;n==GameState.NO||n==GameState.YES||n==GameState.DEFEATED?this.player(!1):this.player(!0)},e.prototype.player=function(t){this.shareBtn.visible=t,this.refreshBtn.visible=t,this.nextBtn.visible=t,this.startBtn.visible=!t},e.prototype.onClick=function(t){switch(t.target){case this.startBtn:Sound.ins().playTask(),StageUtils.removeChild(this),this.setToData();break;case this.closeBtn:case this.shade:Sound.ins().playBtn(),StageUtils.removeChild(this);break;case this.shareBtn:var e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.medal:0,i=GameData.userData?GameData.userData.exp:0,n={task:this.data.id,coin:e,medal:a,exp:i,typeId:this.data.index,title:""},s=Utils.getStting(n);wx.miniProgram.navigateTo({url:GameUrl.SHAREURL+s}),Sound.ins().playShare();break;case this.refreshBtn:this.setToData(),Sound.ins().playTask(),StageUtils.removeChild(this)}},e.prototype.setToData=function(){var t=this.data.userTask?this.data.userTask.state:0,e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.medal:0,i=GameData.userData?GameData.userData.level:0,n={taskId:this.data.id,coin:e,level:i,medal:a,index:this.data.index,state:t,taskType:this.data.taskType,branchId:BranchData.curId},s=Utils.getStting(n);GameUrl.redirectTo(this.data.type,s)},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(ZxTaskView2.prototype,"ZxTaskView2");var DailyItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="DailyItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data},e}(eui.ItemRenderer);__reflect(DailyItem.prototype,"DailyItem");var AwardItem=function(t){function e(e,a){var i=t.call(this)||this;i.skinName="QiPaoItemSkin",i.touchEnabled=!1,i.touchChildren=!1,i.data=a,i.scaleX=i.scaleY=.9;var n=e?"award_left":"award_right";i.bgImg.source=n;var s=a.rewardType?a.rewardType:0;return i.iconImg.source="award"+s,i.data.branch?(i.iconImg.visible=!1,i.titleTxt.visible=!0,i.titleTxt.text=i.data.branch.name):(i.iconImg.visible=!0,i.titleTxt.visible=!1),i}return __extends(e,t),e.prototype.dataChanged=function(){this.data},e}(eui.ItemRenderer);__reflect(AwardItem.prototype,"AwardItem");var GkItem=function(t){function e(){var e=t.call(this)||this;return e.strs=["icon_guanka1","icon_guanka2","icon_guanka3"],e.zxstrs=["icon_guanka1","icon_guanka4","icon_guanka5"],e.stateIcon=["icon13","icon14","icon15"],e.skinName="GkItemSkin",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.isBranch=t.branch?!0:!1,this.iconDisplay2.visible=this.isBranch,this.labelDisplay.text=t.index+"";var e=t.userTask?t.userTask.state:0;if(e==GameState.NO||e==GameState.YES)this.stateImg.visible=!1,this.iconDisplay.source=this.strs[0],this.iconDisplay2.source=this.strs[0],this.touchEnabled=!1;else switch(this.iconDisplay.source=this.strs[1],this.iconDisplay2.source=this.strs[1],this.stateImg.visible=!0,this.touchEnabled=!0,e){case GameState.SUCCEED:this.stateImg.source="icon13";break;case GameState.DEFEATED:this.stateImg.source="icon15";break;case GameState.CHECKING:case GameState.SUB:this.stateImg.source="icon14"}var a=t.taskType==TaskType.ZHU?GameData.ins().getCurIndex():BranchData.ins().getCurIndex();t.index==a&&(this.iconDisplay.source=t.taskType==TaskType.ZHU?this.strs[2]:this.zxstrs[2],this.iconDisplay2.source=t.taskType==TaskType.ZHU?this.strs[2]:this.zxstrs[2],this.touchEnabled=!0)},Object.defineProperty(e.prototype,"lable",{get:function(){return this.labelDisplay.text},set:function(t){this.labelDisplay.text=t+""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"icon",{set:function(t){this.iconDisplay.source=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"data"),this.dataChanged()},enumerable:!0,configurable:!0}),e}(eui.ItemRenderer);__reflect(GkItem.prototype,"GkItem");var Map=function(t){function e(e){void 0===e&&(e=0);var a=t.call(this)||this;return a.guandaoStr="guandao",a.addEndNum=0,a.numArr=[[3,6,6],[4,6,6],[6,6],[6,6],[3,6,6],[6,6]],a.xArr=[[1,1,1],[-1,-1,-1],[0,0],[0,0],[1,1,1],[0,0]],a.yArr=[[0,1,2],[0,1,2],[1,2],[1,2],[0,1,2],[1,2]],a.skinName="MapSkin",a.percentWidth=a.percentHeight=100,a.mapType=e,a.taskData=a.mapType==TaskType.ZHU?GameData.taskData:BranchData.taskData,a.guandaoStr=a.mapType==TaskType.ZHU?"guandao":"zx_gd",GameData.rankIndex=a.mapType,a.addEventListener(egret.Event.ADDED_TO_STAGE,a.addtoStage,a),a.addEventListener(egret.Event.REMOVED_FROM_STAGE,a.removeStage,a),a}return __extends(e,t),e.prototype.addtoStage=function(){this.initGuanDao(),this.btnCon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.scroller.addEventListener(egret.Event.CHANGE,this.onChange,this)},e.prototype.onClick=function(t){if(t.target instanceof GkItem){var e=t.target.data;e.taskType==TaskType.ZHU?e.userTask&&e.userTask.state==GameState.SUCCEED&&e.branch?StageUtils.addChild(new ZxTaskView1(e)):StageUtils.addChild(new TaskView(e)):StageUtils.addChild(new ZxTaskView2(e))}Sound.ins().playBtn()},e.prototype.initGuanDao=function(){this.gdArr=[],this.btnArr=[],this.awardArr=[],this.awardNumArr=[],MapData.MAX=this.taskData?this.taskData.length:0;var t=MapData.getMaxRow(MapData.MAX)+2;4==MapData.MAX||5==MapData.MAX?(t+=1,this.addEndNum=1):3==MapData.MAX?(t+=2,this.addEndNum=2):2==MapData.MAX?(t+=3,this.addEndNum=3):1==MapData.MAX&&(t+=4,this.addEndNum=4);for(var e=0;e<MapData.MAX;e++){for(var a=MapData.getIndex(e+1),i=MapData.mapData[a].gird.length,n=this.taskData?this.taskData[e]:null,s=0;i>s;s++){var r=MapData.mapData[a].gird[s],o=MapData.getCorRow(r[2],e),h=new eui.Image;h.source=""+this.guandaoStr+r[1],h.x=200*r[0],h.y=200*(t-o),h.touchEnabled=!1,this.gdCon.addChild(h),this.gdArr.push(h),e==MapData.MAX-1&&s==i-1&&(this.endPoint=new egret.Point(h.x,h.y),this.upEndGd(a,s))}var c=new GkItem;n&&(c.data=n);var l=MapData.getCorRow(MapData.mapData[a].row,e);c.x=MapData.mapData[a].x,c.y=200*(t-l)+MapData.mapData[a].y,this.btnCon.addChild(c),this.btnArr.push(c);var u=n?n.userTask?n.userTask.state:0:-1;if(u==GameState.NO||n&&n.branch){var d=0==MapData.mapData[a].dir,p=new AwardItem(d,n);this.awardCon.addChild(p);var g=d?c.x-p.width/2:c.x+c.width-30;p.x=g,p.y=c.y-p.height/3*2,this.awardArr.push(p),this.awardNumArr.push(e)}}this.setLayout()},e.prototype.upEndGd=function(t,e){var a=MapData.mapData[t].gird.length,i=MapData.mapData[t].gird[e][1]-1;if(4==i){var n=MapData.mapData[t].gird[e][0],s=void 0;if(s=1==a?MapData.mapData[t-1].gird[MapData.mapData[t-1].gird.length-1][0]:MapData.mapData[t].gird[e-1][0],n>s)this.numArr[i][0]=3;else{this.numArr[i][0]=4;for(var r=0;r<this.xArr[i].length;r++)this.xArr[i][r]=-1}}if(MapData.MAX<=5)for(var o=0;o<this.addEndNum;o++)this.numArr[i].push(this.numArr[i][this.numArr[i].length-1]),this.xArr[i].push(this.xArr[i][this.xArr[i].length-1]),this.yArr[i].push(this.yArr[i][this.yArr[i].length-1]+1);this.createRoad(t,e,i,this.numArr,this.xArr,this.yArr)},e.prototype.setDataArr=function(t,e){var a=[[3,5,4,6,6,6,6],[5,4,6,6,6,6],[4,6,6,6,6],[6,6,6]],i=[[0,-1,-2,-2,-2,-2,-2],[-1,-2,-2,-2,-2,-2],[-1,-1,-1,-1,-1],[0,0,0]],n=[[-1,-1,-1,0,1,2,3],[0,0,1,2,3,4],[0,1,2,3,4],[1,2,3]],s=MapData.MAX%MapData.MAXNUM-20;this.createRoad(t,e,s,a,i,n)},e.prototype.createRoad=function(t,e,a,i,n,s){for(var r=0;r<i[a].length;r++){var o=new eui.Image;o.source=this.mapType==TaskType.ZHU?"guandao"+i[a][r]:"zx_gd"+i[a][r];var h=200*(MapData.mapData[t].gird[e][0]+n[a][r]),c=this.endPoint.y-200*s[a][r];o.x=h,o.y=c,this.gdCon.addChild(o)}},e.prototype.setLayout=function(){var t=this.mapType==TaskType.ZHU?1624:1334,e=this.height;this.gdCon.y+this.gdCon.height>this.height&&(e=this.gdCon.y+this.gdCon.height+150,this.mainCon.height=e);for(var a=Math.ceil(e/t),i=0;a>i;i++){var n=new eui.Image;if(n.source=this.mapType==TaskType.ZHU?"bg1_png":"zx_bg2_jpg",n.y=i*t,n.width=this.width,n.height=t,this.bgCon.addChild(n),this.mapType==TaskType.ZHU)for(var s=0;s<MapData.mapTress.length;s++)for(var r=0;r<MapData.mapTress[s].info.length;r++){var o=new eui.Image;o.source=MapData.mapTress[s].source,o.x=MapData.mapTress[s].info[r].x;var h=this.mainCon.height-1600*(a-i)+MapData.mapTress[s].info[r].y-150;o.y=h,o.touchEnabled=!1,this.treesCon.addChild(o)}}this.bgCon.height=e>this.height?e:StageUtils.ins().getHeight(),this.scroller.height=StageUtils.ins().getHeight(),this.scroller.viewport.validateNow(),this.scroller.viewport.scrollV=this.scroller.viewport.contentHeight-this.scroller.height,this.setCurIndex();var c=new eui.Image;c.source=this.guandaoStr+"6",c.x=200,c.y=this.mainCon.height-200,c.touchEnabled=!1,this.gdCon.addChild(c)},e.prototype.setCurIndex=function(){var t=this.mapType==TaskType.ZHU?GameData.ins().getCurIndex():BranchData.ins().getCurIndex(),e=Math.floor(this.scroller.height/200),a=this.scroller.viewport.contentHeight-this.scroller.height,i=MapData.getIndex(t),n=MapData.mapData[i].row+1,s=MapData.getCorRow(n,t),r=200*s+e/2*200,o=this.scroller.viewport.contentHeight-r;o>=a?this.scroller.viewport.scrollV=a:0>=o?this.scroller.viewport.scrollV=0:this.scroller.viewport.scrollV=o,this.onChange(null)},e.prototype.onChange=function(t){for(var e=this.scroller.height/3,a=this.scroller.viewport.scrollV,i=this.scroller.viewport.scrollV+e,n=a+this.scroller.height-e,s=this.awardArr.length,r=1,o=0,h=0;s>h;h++){var c=this.awardNumArr[h];this.btnArr[c].y>i&&this.btnArr[c].y+this.btnArr[c].height<n?this.awardArr[h].alpha<1?(r=1,o=300*(1-this.awardArr[h].alpha)):o=0:this.awardArr[h].alpha>0?(r=0,o=300*this.awardArr[h].alpha):o=0,egret.Tween.removeTweens(this.awardArr[h]),o>0&&egret.Tween.get(this.awardArr[h]).to({alpha:r},o)}},e.prototype.onChangeEnd=function(t){},e.prototype.removeStage=function(){this.btnCon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.scroller.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onChange,this)},e}(eui.Component);__reflect(Map.prototype,"Map");var MapData=function(){function t(){}return t.getMaxRow=function(e){if(!(0>=e)){for(var a=t.getIndex(e),i=0,n=0;a>=n;n++)t.mapData[n].row>i&&(i=t.mapData[n].row);var s=i+t.getRow(e)*t.MAXROW;return s}},t.getIndex=function(e){var a;return a=e%t.MAXNUM==0?t.MAXNUM-1:e%t.MAXNUM-1},t.getRow=function(e){var a=Math.floor(e/t.MAXNUM);return e%t.MAXNUM==0&&(a=Math.floor(e/t.MAXNUM)-1),a},t.getCorRow=function(e,a){var i=0;return a<t.MAXNUM?i=e:a==t.MAXNUM?i=t.MAXROW:a>t.MAXNUM&&(i=a%t.MAXNUM==0?e+Math.floor(a/t.MAXNUM)*t.MAXROW:e+t.getRow(a)*t.MAXROW),i},t.MAXNUM=9,t.MAXROW=8,t.MAX=0,t.mapData=[{index:1,x:300,y:50,gird:[[1,1,0],[2,3,0]],row:0,dir:0},{index:2,x:437.5,y:100,gird:[[2,6,1]],row:1,dir:1},{index:3,x:437.5,y:50,gird:[[2,6,2]],row:2,dir:0},{index:4,x:350,y:50,gird:[[2,2,3],[1,5,3]],row:3,dir:1},{index:5,x:70,y:50,gird:[[0,4,3]],row:3,dir:0},{index:6,x:37.5,y:40,gird:[[0,6,4]],row:4,dir:1},{index:7,x:37.5,y:20,gird:[[0,6,5]],row:5,dir:0},{index:8,x:220,y:40,gird:[[0,1,6],[1,3,6]],row:6,dir:1},{index:9,x:237.5,y:50,gird:[[1,6,7]],row:7,dir:0}],t.mapTress=[{source:"icon_grass",info:[{x:-50,y:850},{x:0,y:240},{x:350,y:1200},{x:550,y:565},{x:580,y:950}]},{source:"icon_house",info:[{x:0,y:80},{x:230,y:990},{x:280,y:380}]},{source:"icon_tree",info:[{x:0,y:1100},{x:160,y:740},{x:240,y:740},{x:260,y:1330},{x:340,y:1330},{x:530,y:480}]}],t.mapTressZx=[{source:"icon_grass",info:[{x:-50,y:850},{x:0,y:240},{x:350,y:1200},{x:550,y:565},{x:580,y:950}]}],t}();__reflect(MapData.prototype,"MapData");var BranchRankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="BranchRankItemSkin",e.iconImg.mask=e.mackRect,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.index=this.itemIndex+1,t&&(this.index<=3?(this.rankNum.visible=!1,this.rankIcon.visible=!0,this.rankIcon.source="rank"+t):(this.rankNum.visible=!0,this.rankIcon.visible=!1,this.rankNum.text=t+""))},e}(eui.ItemRenderer);__reflect(BranchRankItem.prototype,"BranchRankItem");var BranchRankWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="BranchRankSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),this.list.itemRenderer=RankItem},e.prototype.initData=function(){},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.closeBtn:case this.shade:StageUtils.removeChild(this)}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(BranchRankWin.prototype,"BranchRankWin");var RankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RankItemSkin",e.iconImg.mask=e.mackRect,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this,e=this.data;if(this.index=this.itemIndex+1,e){ImageLoader.Image(e.avatarUrl).then(function(e){t.iconImg.source=e}),this.lvTxt.text="Lv."+e.level;var a=Utils.getStringLength(e.nickName),i=e.nickName;a>16&&(i=e.nickName.substring(0,8)+"..."),this.nameTxt.text=i,this.index<=3?(this.rankNum.visible=!1,this.rankIcon.visible=!0,this.rankIcon.source="rank"+this.index):(this.rankNum.visible=!0,this.rankIcon.visible=!1,this.rankNum.text=this.index+"")}},e}(eui.ItemRenderer);__reflect(RankItem.prototype,"RankItem");var RankWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="RankSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),Http.ins().send(GameUrl.rankUrl+GameData.rankLineIdArr[GameData.rankIndex]+"/rank",!0,this,this.initData)},e.prototype.initData=function(t){var e=t.result;this.list.itemRenderer=RankItem,this.list.dataProvider=new eui.ArrayCollection(e)},e.prototype.sort=function(t,e){var a=t.level,i=e.level;return i>a?1:a>i?-1:0},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.closeBtn:case this.shade:StageUtils.removeChild(this)}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(RankWin.prototype,"RankWin");var GameView=function(t){function e(){var a=t.call(this)||this;return a.skinName="GameViewSkin",e.self=a,a}return __extends(e,t),e.prototype.open=function(){UIView.self.backHome.visible=!1,this.map=new Map,this.mapCon.addChild(this.map)},e.prototype.onClick=function(t){t.target},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(GameView.prototype,"GameView");var UIView=function(t){function e(){var a=t.call(this)||this;return a.skinName="UIViewSkin",e.self=a,a}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.jiaBtn,this.onClick),this.addTouchEvent(this.xiaoxiBtn,this.onClick),this.addTouchEvent(this.bagBtn,this.onClick),this.addTouchEvent(this.rankBtn,this.onClick),this.addTouchEvent(this.helpBtn,this.onClick),this.addTouchEvent(this.friendBtn,this.onClick),this.addTouchEvent(this.dailyTaskBtn,this.onClick),this.addTouchEvent(this.backHome,this.onClick),e.self.backHome.visible=!1,this.yunCon.touchChildren=!1,this.yunCon.touchEnabled=!1,this.txImg.mask=this.rectMack,this.tween(),this.initData()},e.prototype.initData=function(){GameData.userData&&(this.txImg.source=GameData.userData.avatarUrl,this.lvTxt.text="Lv."+GameData.userData.level,this.goldTxt.text=GameData.userData.coin+"",this.mdalTxt.text=GameData.userData.medal+"")},e.prototype.tween=function(){var t=egret.Tween.get(this.yun0,{loop:!0}),e=egret.Tween.get(this.yun1,{loop:!0}),a=egret.Tween.get(this.yun2,{loop:!0}),i=egret.Tween.get(this.yun3,{loop:!0}),n=egret.Tween.get(this.yun4,{loop:!0});t.to({x:110},1e4).to({x:75},1e4),e.to({x:445},1e4).to({x:280},12e3).to({x:336},1e4),a.to({x:-300},15e3).to({x:-162},14e3),i.to({x:800},2e4).to({x:242},2e4),n.to({x:-600},18e3).to({x:-125},21e3)},e.prototype.onClick=function(t){switch(t.target){case this.xiaoxiBtn:Sound.ins().playMessage();var e="亲爱的时间调查员：模拟试炼即将结束，系统需要重启。重启后时间调查员的任务将重新开启，历史数据将被清空，时间调查员们，新的试炼即将到来，一起拯救地球吧。";StageUtils.addChild(new MessageWin("消息",e));break;case this.bagBtn:Sound.ins().playBtn(),StageUtils.addChild(new BagView);break;case this.rankBtn:Sound.ins().playBtn(),StageUtils.addChild(new RankWin);break;case this.helpBtn:Sound.ins().playMessage();var a=GameData.userData?GameData.userData.nickName:"",i="亲爱的时间调查员"+a+"：鉴于你刚刚来到地球，时间调查委员会为你安排了一位地球顾问，如果需要帮助可以联系他，他的微信是"+a+"，但是要尽量少联系，避免暴露你们的身份。";StageUtils.addChild(new MessageWin("帮助",i));break;case this.friendBtn:Sound.ins().playBtn(),StageUtils.addChild(new CommanView(0));break;case this.dailyTaskBtn:Sound.ins().playBtn(),StageUtils.addChild(new DailyTaskView);break;case this.backHome:BranchData.curId=null;var n=new GameView;StageUtils.addChild(n,0)}},e.prototype.close=function(){this.removeEvents(),egret.Tween.removeTweens(this.yun0),egret.Tween.removeTweens(this.yun1),egret.Tween.removeTweens(this.yun2),egret.Tween.removeTweens(this.yun3),egret.Tween.removeTweens(this.yun4)},e}(BaseView);__reflect(UIView.prototype,"UIView");var CommanView=function(t){function e(e,a){void 0===e&&(e=0);var i=t.call(this)||this;return i.skinName="CommanViewSkin",i.editable.maxChars=4,i.editable.restrict="0-9",i.editable.inputType=egret.TextFieldInputType.TEL,i.currentState=0==e?"input":"output",a&&!isNaN(a)&&(i.numTxt.text=a+""),i}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.startBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),this.addTouchEvent(this.putBtn,this.onClick),this.editable.addEventListener(egret.Event.CHANGE,this.setKeyNum,this),this.editable.addEventListener(egret.FocusEvent.FOCUS_IN,this.upEditableText,this),this.editable.addEventListener(egret.FocusEvent.FOCUS_OUT,this.focusoutHandler,this),this.txImg.mask=this.rectMack},e.prototype.initData=function(t){var e=this,a=t;if(this.data=a.result,a&&0==a.code){if(this.data.invitation){if(GameData.userData&&this.data.invitation.invitationUserNickname==GameData.userData.nickName)return this.hintTxt.visible=!0,void(this.hintTxt.text="不能加入自己的房间");ImageLoader.Image(this.data.invitation.invitationUserAvatar).then(function(t){e.txImg.source=t}),this.nameTxt.text=this.data.invitation.invitationUserNickname+"",this.taskTxt.text="将代替“"+this.data.invitation.invitationUserNickname+"”，完成“"+this.data.name+"”关卡"}this.hintTxt.visible=!1,this.currentState="output"}else this.hintTxt.visible=!0,this.hintTxt.text=a.msg?a.msg:"口令错误"},e.prototype.setKeyNum=function(){parseInt(this.editable.text);this.numTxt.text=this.editable.text},e.prototype.upEditableText=function(){this.editable.text="",this.numTxt.text=""},e.prototype.focusoutHandler=function(){document.body.scrollTop=0},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.putBtn:if(this.numTxt.text){var e=GameUrl.inviteUrl+"?invitationCode="+this.numTxt.text;Http.ins().send(e,!0,this,this.initData)}else this.hintTxt.visible=!0;break;case this.closeBtn:case this.shade:StageUtils.removeChild(this);break;case this.startBtn:this.sendInvite()}},e.prototype.sendInvite=function(){if(this.data){var t=this.data.userTask?this.data.userTask.state:0,e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.level:0,i=GameData.userData?GameData.userData.medal:0,n={};n.taskId=this.data.id,n.coin=e,n.level=a,n.medal=i,n.state=t,n.invitationCode=this.numTxt.text,n.avatar=decodeURIComponent(this.data.invitation.invitationUserAvatar);var s=Utils.getStting(n);GameUrl.redirectTo(this.data.type,s)
}},e.prototype.close=function(){this.removeEvents(),this.editable.removeEventListener(egret.Event.CHANGE,this.setKeyNum,this),this.editable.removeEventListener(egret.FocusEvent.FOCUS_IN,this.upEditableText,this),this.editable.removeEventListener(egret.FocusEvent.FOCUS_OUT,this.focusoutHandler,this)},e}(BaseView);__reflect(CommanView.prototype,"CommanView");var DailyTaskView=function(t){function e(){var e=t.call(this)||this;return e.skinName="DailyTaskSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.shade,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.init()},e.prototype.init=function(){this.list.itemRenderer=DailyItem},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.shade:case this.closeBtn:StageUtils.removeChild(this)}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(DailyTaskView.prototype,"DailyTaskView");var FriendHelpView=function(t){function e(){var e=t.call(this)||this;return e.skinName="FriendHelpSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.startBtn,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.refreshBtn,this.onClick),this.addTouchEvent(this.shareBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),this.initData()},e.prototype.initData=function(){var t=this;GameData.taskData;GameData.userData&&GameData.userData.avatarUrl&&(this.txImg.mask=this.rectMack,ImageLoader.Image(GameData.userData.avatarUrl).then(function(e){t.txImg.source=e}));var e={source:"gold2",text:"+30"};this.iconBase=new AwardList,this.iconBase.height=this.infoCon.height,this.infoCon.addChild(this.iconBase),this.iconBase.data=e,this.list.itemRenderer=AwardList;var a=[{source:"gold2",text:"+30"},{source:"icon_xp1",text:"+100"},{source:"icon_xz2",text:"+20"}];this.list.dataProvider=new eui.ArrayCollection(a),this.nameTxt.text=GameData.userData.nickName},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.refreshBtn:break;case this.shareBtn:break;case this.startBtn:break;case this.closeBtn:case this.shade:StageUtils.removeChild(this)}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(FriendHelpView.prototype,"FriendHelpView");var MessageWin=function(t){function e(e,a){var i=t.call(this)||this;return i.viewHeight=0,i.skinName="MessageSkin",i.titleStr=e?e:null,i.contentStr=a?a:null,i}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),this.addTouchEvent(this.startBtn,this.onClick),this.initData()},e.prototype.initData=function(){this.titleStr&&(this.titleTxt.text=this.titleStr),this.contentStr&&(this.contentTxt.text=this.contentStr),this.viewHeight=this.contentTxt.y+this.contentTxt.height+249,this.viewHeight>this.bg.height&&(this.bg.height=this.viewHeight)},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.closeBtn:case this.shade:case this.startBtn:StageUtils.removeChild(this)}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(MessageWin.prototype,"MessageWin");var ResultWin=function(t){function e(){var e=t.call(this)||this;return e.iconStr=["award0","award1","award2"],e.skinName="ResultSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.shade,this.onClick),Utils.ins().playAnimation(this.dong,!0)},e.prototype.setData=function(t){t.index<=3?this.iconImg.source="award"+t.index:this.iconImg.source=t.icon,0==t.index?this.gbg.source="shan2_png":this.gbg.source="shan_png",this.contentTxt.text=t.lable},e.prototype.onClick=function(t){switch(t.target){case this.shade:StageUtils.removeChild(this),Sound.ins().playBtn()}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(ResultWin.prototype,"ResultWin");var ShiBaiWin=function(t){function e(e){var a=t.call(this)||this;return a.skinName="ShiBaiSkin",a.data=e,a}return __extends(e,t),e.prototype.open=function(){if(this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.startBtn,this.onClick),this.list.itemRenderer=AwardList,this.data&&this.data.payload){this.nameTxt.text=this.data.payload.taskName;var t=this.data.payload.medals?this.data.payload.medals.length:0,e=[{source:"gold2",text:"+"+this.data.payload.coin},{source:"icon_xp1",text:"+"+this.data.payload.exp},{source:"icon_xz2",text:"+"+t}];this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.onClick=function(t){switch(t.target){case this.shade:case this.closeBtn:case this.startBtn:Sound.ins().playBtn(),StageUtils.removeChild(this)}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(ShiBaiWin.prototype,"ShiBaiWin");var SignInWin=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="SignInSkin",e}return __extends(e,t),e.prototype.open=function(){this.btnArr=[],this.list.itemRenderer=AwardList;for(var t=GameData.signinData,e=(t?t.length:0,0);7>e;e++){var a=new DayItem;a.name=""+e;var i=!1;t[e]&&null!=t[e].signedAt&&(i=!0),a.data={index:e,state:i},4>e?this.topCon.addChild(a):this.bottomCon.addChild(a),this.btnArr.push(a),this.addTouchEvent(a,this.onClick)}this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.startBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),this.qiandao()},e.prototype.qiandao=function(){var t=this;Http.ins().send(GameUrl.sendSigninUrl,!1,this,function(e){console.log("签到",e);var a=e;0==a.code&&(Utils.showResult(0,a.result.coin),Http.ins().send(GameUrl.signinUrl,!0,t,function(e){var a=e.result;GameData.signinData=a,t.upData()}))})},e.prototype.upData=function(){var t=GameData.signinData;if(t){for(var e=t.length,a=0;e>a;a++)this.btnArr[a].curState=t[a].signedAt?!0:!1;this.index=GameData.ins().getSigninDay(),this.setIndex()}},e.prototype.setIndex=function(){var t=GameData.signinData;if(this.hintTxt2.text="连续"+(this.index+1)+"天签到，您可获得：",t&&t[this.index]){var e=[{source:"gold2",text:"+"+t[this.index].coin},{source:"icon_xp1",text:"+"+t[this.index].exp}];this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn:case this.shade:StageUtils.removeChild(this),Sound.ins().playBtn();break;case this.startBtn:Sound.ins().playShare();var e="?days="+GameData.ins().getSigninDay();wx.miniProgram.navigateTo({url:GameUrl.SIGNSHARE+e})}t.target instanceof DayItem&&(this.index=t.target.data.index,this.setIndex(),GameData.ins().getDaySignin(this.index)&&this.qiandao())},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(SignInWin.prototype,"SignInWin");var DayItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="DayItemSkin",e.touchEnabled=!0,e.touchChildren=!1,e.currentState="no",e}return __extends(e,t),e.prototype.dataChanged=function(){this.labelDisplay.text=this.data.index+1+"",this.currentState=this.data.state?"yes":"no"},e.prototype.setData=function(t){this.labelDisplay.text=t+""},Object.defineProperty(e.prototype,"curState",{set:function(t){this.currentState=t?"yes":"no"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"data"),this.dataChanged()},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(DayItem.prototype,"DayItem");var TaskView=function(t){function e(e){var a=t.call(this)||this;return a.skinName="TaskViewSkin",a.data=e,a}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.startBtn,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.shade,this.onClick),this.addTouchEvent(this.shareBtn,this.onClick),this.addTouchEvent(this.refreshBtn,this.onClick),this.addTouchEvent(this.nextBtn,this.onClick),this.txList.itemRenderer=TxItem,this.list.itemRenderer=AwardList;var t=GameUrl.taskUrl+"/"+this.data.id;Http.ins().send(t,!0,this,this.initData),this.data.completeUserAvatars&&(this.txList.dataProvider=new eui.ArrayCollection(this.data.completeUserAvatars)),this.numTxt.text=this.data.completeNumber+"位调查员正在收集"},e.prototype.initData=function(t){this.taskData=t.result,this.titleTxt.text=this.taskData.name;var e=this.taskData.coin?this.taskData.coin:0,a=this.taskData.exp?this.taskData.exp:0,i=this.taskData.medalId?this.taskData.medalId.split(","):[],n=[{source:"gold2",text:"+"+e},{source:"icon_xp1",text:"+"+a},{source:"icon_xz2",text:"+"+i.length}];this.list.dataProvider=new eui.ArrayCollection(n);var s=this.data.userTask?this.data.userTask.state:0;s==GameState.NO||s==GameState.YES||s==GameState.DEFEATED?this.player(!1):this.player(!0)},e.prototype.onClick=function(t){switch(t.target){case this.startBtn:this.setToData(),Sound.ins().playTask(),StageUtils.removeChild(this);break;case this.closeBtn:case this.shade:Sound.ins().playBtn(),StageUtils.removeChild(this);break;case this.shareBtn:var e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.medal:0,i=GameData.userData?GameData.userData.exp:0,n={task:this.data.id,coin:e,medal:a,exp:i,typeId:this.data.index,title:this.taskData.name},s=Utils.getStting(n);wx.miniProgram.navigateTo({url:GameUrl.SHAREURL+s}),Sound.ins().playShare();break;case this.refreshBtn:this.setToData(),Sound.ins().playTask(),StageUtils.removeChild(this);break;case this.nextBtn:this.playNext()}},e.prototype.player=function(t){this.shareBtn.visible=t,this.refreshBtn.visible=t,this.nextBtn.visible=t,this.startBtn.visible=!t},e.prototype.playNext=function(){var t=this.data.index+1;this.data=GameData.taskData[t-1];var e=GameUrl.taskUrl+"/"+this.data.id;Http.ins().send(e,!0,this,this.initData),GameData.taskData[this.data.index-1].completeUserAvatars&&(this.txList.dataProvider=new eui.ArrayCollection(GameData.taskData[this.data.index-1].completeUserAvatars)),this.numTxt.text=GameData.taskData[this.data.index-1].completeNumber+"位调查员正在收集",this.player(!1)},e.prototype.putInData=function(){this.data.state==GameState.NO},e.prototype.setToData=function(){var t=this.data.userTask?this.data.userTask.state:0,e=GameData.userData?GameData.userData.coin:0,a=GameData.userData?GameData.userData.medal:0,i=GameData.userData?GameData.userData.level:0,n={taskId:this.data.id,coin:e,level:i,medal:a,index:this.data.index,state:t},s=Utils.getStting(n);GameUrl.redirectTo(this.data.type,s)},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(TaskView.prototype,"TaskView");var TxItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TxItemSkin",e.iconImg.mask=e.mackRect,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this,e=this.data;ImageLoader.Image(e).then(function(e){t.iconImg.source=e})},e}(eui.ItemRenderer);__reflect(TxItem.prototype,"TxItem");var ZuDui=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZuDuiSkin",e.editable.maxChars=4,e.editable.restrict="0-9",e.editable.inputType=egret.TextFieldInputType.TEL,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.shade,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.editable.addEventListener(egret.Event.CHANGE,this.setKeyNum,this),this.editable.addEventListener(egret.FocusEvent.FOCUS_IN,this.upEditableText,this),this.editable.addEventListener(egret.FocusEvent.FOCUS_OUT,this.focusoutHandler,this),this.init()},e.prototype.init=function(){this.list.itemRenderer=TxItem,this.list.itemRenderer=AwardList},e.prototype.setKeyNum=function(){parseInt(this.editable.text);this.numTxt.text=this.editable.text},e.prototype.upEditableText=function(){this.editable.text="",this.numTxt.text=""},e.prototype.focusoutHandler=function(){document.body.scrollTop=0},e.prototype.onClick=function(t){switch(Sound.ins().playBtn(),t.target){case this.shade:case this.closeBtn:StageUtils.removeChild(this)}},e.prototype.close=function(){this.removeEvents()},e}(BaseView);__reflect(ZuDui.prototype,"ZuDui");